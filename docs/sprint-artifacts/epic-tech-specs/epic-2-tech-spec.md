# Epic 2: Core Content Display - Technical Specification

**Epic ID:** 2
**Epic Title:** Core Content Display
**Date:** 2025-11-29
**Author:** Generated by Epic Tech Context Specialist

---

## 1. Epic Overview

### 1.1 Description

Epic 2 delivers the core content display functionality for AI Obituaries. Users will be able to see the prominent obituary count, browse obituaries in a card list format, view individual obituary detail pages with full contextual data, and share obituaries via SEO-optimized pages with rich metadata.

This epic transforms the foundation established in Epic 1 into a functional content-driven application where users can explore AI skepticism claims with full contextual evidence.

### 1.2 Business Value and Goals

- **Showcase the Pattern:** Display the total obituary count prominently as the headline metric that proves the pattern of AI skepticism
- **Enable Content Discovery:** Allow users to browse and explore individual obituaries with their full context
- **Maximize Shareability:** Ensure every obituary has a dedicated, SEO-optimized page that displays well when shared on social platforms
- **Provide Contextual Evidence:** Show "what AI could do" at the time each claim was made (stock prices, benchmarks, milestones)
- **Support Search Discovery:** Implement structured data and sitemap for search engine visibility

### 1.3 Functional Requirements Covered

| FR ID | Requirement | Story |
|-------|-------------|-------|
| FR1 | System displays total obituary count prominently on homepage | 2.1 |
| FR2 | System displays list of all obituaries with claim preview, source, and date | 2.2 |
| FR3 | Users can view individual obituary details including full claim text, source with link, date, and category tags | 2.3 |
| FR4 | System displays contextual data for each obituary (AI capabilities, stock prices, benchmarks at time of claim) | 2.4 |
| FR19 | Each obituary has a dedicated page with unique, semantic URL | 2.3 |
| FR23 | Obituary pages include full contextual snapshot display | 2.4 |
| FR27 | Each obituary page has unique meta title and description | 2.5 |
| FR28 | System generates Open Graph and Twitter Card meta tags for social sharing | 2.5 |
| FR29 | System generates JSON-LD structured data for rich search snippets | 2.6 |
| FR30 | System automatically generates sitemap including all obituary pages | 2.7 |
| FR32 | Users can copy shareable link for any obituary | 2.8 |
| FR33 | Obituary pages display well when shared on social platforms (preview cards) | 2.5, 2.8 |

### 1.4 Scope

**In-Scope (8 Stories):**
- Story 2.1: Hero Count Display (prominent count with gold styling, pulsing glow)
- Story 2.2: Obituary List Display (card grid with claim preview, source, date, category)
- Story 2.3: Individual Obituary Pages (dedicated pages with semantic URLs)
- Story 2.4: Contextual Snapshot Display (stock prices, benchmarks, milestones)
- Story 2.5: SEO Meta Tags (title, description, Open Graph, Twitter Cards)
- Story 2.6: JSON-LD Structured Data (Article schema for rich snippets)
- Story 2.7: Sitemap Generation (auto-generated sitemap with all obituaries)
- Story 2.8: Share/Copy Link (copy button with toast feedback)

**Out-of-Scope:**
- Timeline visualization (Epic 3)
- Category filtering UI (Epic 4)
- Modal preview from timeline (Epic 3)
- Previous/Next navigation on detail pages (Epic 5)
- Breadcrumb navigation (Epic 5)
- Mobile-specific layout optimizations (Epic 5)
- Dynamic OG image generation (Growth feature)
- Search functionality (Growth feature)

### 1.5 Dependencies and Prerequisites

**Epic Dependencies:**
- Epic 1 must be complete (Foundation)
  - Sanity CMS integration (Story 1.3)
  - Design system with Deep Archive theme (Story 1.2)
  - Layout shell with Header/Footer (Story 1.4)
  - ISR revalidation webhook (Story 1.5)

**External Dependencies:**
- Sanity CMS must have obituary schema deployed and at least test data
- Default OG image asset (placeholder acceptable, can be designed later)

**Default OG Image Specification:**
- **Path:** `/public/og/default.png`
- **Dimensions:** 1200x630 pixels (standard OG image size)
- **Format:** PNG (supports transparency if needed)
- **Design Guidance:** Deep Archive theme background (#0D0D12), centered "AI Obituaries" text in gold (#C9A962), tagline "Documenting AI Skepticism" in muted text (#9A9AAF). Can use placeholder gradient until final design is ready.

---

## 2. Technical Context

### 2.1 Relevant Architecture Decisions

| ADR | Decision | Impact on Epic 2 |
|-----|----------|------------------|
| ADR-001 | Sanity CMS over JSON Files | All obituary data fetched via GROQ queries using client from Epic 1 |
| ADR-002 | Visx over vis-timeline | (Not used in Epic 2, but visualization components excluded) |
| ADR-004 | URL State with nuqs | Filter state in URL for future integration (not actively used yet) |

### 2.2 Technology Stack Details for Epic 2

| Technology | Version | Purpose in Epic 2 |
|------------|---------|-------------------|
| Next.js | 16.0.5 | App Router, SSG with `generateStaticParams`, metadata API |
| React | 19.x | Server and Client Components |
| TypeScript | 5.x | Type-safe data handling |
| Tailwind CSS | 4.1.x | Styling cards, layouts, typography |
| shadcn/ui | 3.5.0 | Card, Toast components |
| @sanity/client | 6.29.1 | Data fetching (reuse from Epic 1) |
| date-fns | 4.1.0 | Date formatting for display |
| Motion | 12.9.2 | Count pulsing animation, card hover effects |

### 2.3 Project Structure (Epic 2 Additions)

```
src/
├── app/
│   ├── page.tsx                    # Modify: Add count display, obituary list
│   ├── sitemap.ts                  # Create: Dynamic sitemap generation
│   ├── robots.ts                   # Create: Robots.txt generation
│   └── obituary/
│       └── [slug]/
│           ├── page.tsx            # Create: Individual obituary page
│           └── not-found.tsx       # Create: 404 for invalid slugs
│
├── components/
│   ├── obituary/
│   │   ├── count-display.tsx       # Create: Hero count component
│   │   ├── obituary-card.tsx       # Create: Card component for list
│   │   ├── obituary-list.tsx       # Create: Grid container for cards
│   │   ├── obituary-detail.tsx     # Create: Full detail view
│   │   └── obituary-context.tsx    # Create: Context metadata display
│   ├── seo/
│   │   └── json-ld.tsx             # Create: Structured data component
│   └── ui/
│       ├── copy-button.tsx         # Create: Copy link button
│       ├── toast.tsx               # Add: shadcn toast
│       └── toaster.tsx             # Add: shadcn toaster
│
├── lib/
│   ├── sanity/
│   │   └── queries.ts              # Modify: Add queries for Epic 2
│   └── utils/
│       ├── seo.ts                  # Create: SEO helper functions
│       └── format.ts               # Create: Formatting utilities
│
└── public/
    └── og/
        └── default.png             # Create: Default OG image (1200x630)
```

### 2.4 Integration Points

```
Epic 2 Data Flow Architecture:

┌─────────────────┐
│   Sanity CMS    │
│   (obituaries)  │
└────────┬────────┘
         │ GROQ: getObituaries(), getObituaryBySlug(), getObituaryCount()
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Server Components                            │
│                                                                  │
│  ┌─────────────┐   ┌─────────────────┐   ┌──────────────────┐  │
│  │  page.tsx   │   │ obituary/[slug] │   │   sitemap.ts     │  │
│  │  (homepage) │   │    /page.tsx    │   │   (dynamic)      │  │
│  └─────┬───────┘   └────────┬────────┘   └──────────────────┘  │
│        │                     │                                   │
│        ▼                     ▼                                   │
│  ┌─────────────┐   ┌─────────────────┐                          │
│  │CountDisplay │   │ ObituaryDetail  │  ← Includes JsonLd       │
│  │ObituaryList │   │ ObituaryContext │                          │
│  └─────────────┘   │ CopyButton      │                          │
│                     └─────────────────┘                          │
└─────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Client Components                            │
│                                                                  │
│  ┌─────────────┐   ┌─────────────────┐                          │
│  │ CopyButton  │   │   Toast/Toaster │  ← Clipboard feedback    │
│  │ (use client)│   │   (use client)  │                          │
│  └─────────────┘   └─────────────────┘                          │
└─────────────────────────────────────────────────────────────────┘

SEO Output:
┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
│   <head>        │   │  /sitemap.xml   │   │  /robots.txt    │
│   - <title>     │   │  - all URLs     │   │  - Allow: /     │
│   - og:*        │   │  - lastmod      │   │  - Sitemap ref  │
│   - twitter:*   │   │                 │   │                 │
│   - JSON-LD     │   │                 │   │                 │
└─────────────────┘   └─────────────────┘   └─────────────────┘
```

---

## 3. Data Models

### 3.1 TypeScript Type Definitions

```typescript
// src/types/obituary.ts

/**
 * Category enum representing the classification of AI skepticism claims.
 * Each category has an associated color defined in CSS variables.
 */
export type Category = 'capability' | 'market' | 'agi' | 'dismissive';

/**
 * Context metadata capturing the AI landscape at the time of the claim.
 * All fields are optional as historical data may be incomplete.
 */
export interface ContextMetadata {
  /** NVIDIA stock price at time of claim (USD) */
  nvdaPrice?: number;
  /** Microsoft stock price at time of claim (USD) */
  msftPrice?: number;
  /** Google/Alphabet stock price at time of claim (USD) */
  googPrice?: number;
  /** Name of the latest AI model at time of claim (e.g., "GPT-4", "Claude 2") */
  currentModel?: string;
  /** Benchmark name for AI capability measurement */
  benchmarkName?: string;
  /** Benchmark score as percentage (0-100) */
  benchmarkScore?: number;
  /** Notable AI milestone achieved around time of claim */
  milestone?: string;
  /** Additional contextual notes */
  note?: string;
}

/**
 * Main Obituary type representing a documented AI skepticism claim.
 * Maps directly to Sanity CMS obituary document schema.
 */
export interface Obituary {
  /** Sanity document ID */
  _id: string;
  /** URL-safe unique identifier for routing */
  slug: string;
  /** The skeptical claim text (full quote) */
  claim: string;
  /** Person or publication who made the claim */
  source: string;
  /** URL to the original article/source */
  sourceUrl: string;
  /** ISO 8601 date string when claim was made */
  date: string;
  /** Classification categories for the claim (1-4 categories) */
  categories: Category[];
  /** Contextual data about AI landscape at time of claim */
  context: ContextMetadata;
  /** Sanity document timestamps */
  _createdAt: string;
  _updatedAt: string;
}

/**
 * Lightweight obituary type for list/card views (excludes full context).
 * Used by getObituaries() for homepage listing.
 */
export interface ObituarySummary {
  _id: string;
  slug: string;
  claim: string;
  source: string;
  date: string;
  categories: Category[];
}
```

### 3.2 Validation Rules

| Field | Type | Required | Validation |
|-------|------|----------|------------|
| `_id` | string | Yes | Sanity auto-generated |
| `slug` | string | Yes | Lowercase, alphanumeric, hyphens only; max 100 chars |
| `claim` | string | Yes | Non-empty; max 2000 chars |
| `source` | string | Yes | Non-empty; max 200 chars |
| `sourceUrl` | string | Yes | Valid URL format |
| `date` | string | Yes | ISO 8601 date format (YYYY-MM-DD) |
| `categories` | Category[] | Yes | At least 1, max 4; valid enum values |
| `context.nvdaPrice` | number | No | Positive number |
| `context.msftPrice` | number | No | Positive number |
| `context.googPrice` | number | No | Positive number |
| `context.currentModel` | string | No | Max 100 chars |
| `context.benchmarkName` | string | No | Max 100 chars |
| `context.benchmarkScore` | number | No | 0-100 range |
| `context.milestone` | string | No | Max 500 chars |
| `context.note` | string | No | Max 500 chars |

### 3.3 Sanity Schema Reference

The Sanity CMS schema (defined in Epic 1) maps to these types:

```typescript
// Sanity schema definition (for reference)
{
  name: 'obituary',
  type: 'document',
  fields: [
    { name: 'slug', type: 'slug', options: { source: 'claim', maxLength: 100 } },
    { name: 'claim', type: 'text', validation: Rule => Rule.required().max(2000) },
    { name: 'source', type: 'string', validation: Rule => Rule.required().max(200) },
    { name: 'sourceUrl', type: 'url', validation: Rule => Rule.required() },
    { name: 'date', type: 'date', validation: Rule => Rule.required() },
    { name: 'categories', type: 'array', of: [{ type: 'string' }],
      options: { list: ['capability', 'market', 'agi', 'dismissive'] } },
    { name: 'context', type: 'object', fields: [
      { name: 'nvdaPrice', type: 'number' },
      { name: 'msftPrice', type: 'number' },
      { name: 'googPrice', type: 'number' },
      { name: 'currentModel', type: 'string' },
      { name: 'benchmarkName', type: 'string' },
      { name: 'benchmarkScore', type: 'number' },
      { name: 'milestone', type: 'string' },
      { name: 'note', type: 'string' },
    ]},
  ]
}
```

---

## 4. Sanity Query Functions

### 4.1 GROQ Query Specifications

```typescript
// src/lib/sanity/queries.ts

import { sanityClient } from './client'
import type { Obituary, ObituarySummary } from '@/types/obituary'

/**
 * Fetch all obituaries for list display, sorted by date descending.
 * Returns summary data (excludes full context for performance).
 */
export async function getObituaries(): Promise<ObituarySummary[]> {
  const query = `*[_type == "obituary"] | order(date desc) {
    _id,
    "slug": slug.current,
    claim,
    source,
    date,
    categories
  }`

  return sanityClient.fetch<ObituarySummary[]>(query, {}, {
    next: { tags: ['obituaries'] }
  })
}

/**
 * Fetch a single obituary by slug with full context data.
 * Returns null if not found.
 */
export async function getObituaryBySlug(slug: string): Promise<Obituary | null> {
  const query = `*[_type == "obituary" && slug.current == $slug][0] {
    _id,
    "slug": slug.current,
    claim,
    source,
    sourceUrl,
    date,
    categories,
    context {
      nvdaPrice,
      msftPrice,
      googPrice,
      currentModel,
      benchmarkName,
      benchmarkScore,
      milestone,
      note
    },
    _createdAt,
    _updatedAt
  }`

  return sanityClient.fetch<Obituary | null>(query, { slug }, {
    next: { tags: ['obituaries'] }
  })
}

/**
 * Fetch total count of published obituaries.
 * Used for hero count display.
 */
export async function getObituaryCount(): Promise<number> {
  const query = `count(*[_type == "obituary"])`

  return sanityClient.fetch<number>(query, {}, {
    next: { tags: ['obituaries'] }
  })
}

/**
 * Fetch all obituary slugs for static generation.
 * Used by generateStaticParams().
 */
export async function getAllObituarySlugs(): Promise<string[]> {
  const query = `*[_type == "obituary"].slug.current`

  return sanityClient.fetch<string[]>(query, {}, {
    next: { tags: ['obituaries'] }
  })
}
```

### 4.2 Query Performance Notes

| Function | Expected Response | Caching |
|----------|-------------------|---------|
| `getObituaries()` | < 200ms | ISR tagged `obituaries` |
| `getObituaryBySlug()` | < 100ms | ISR tagged `obituaries` |
| `getObituaryCount()` | < 50ms | ISR tagged `obituaries` |
| `getAllObituarySlugs()` | < 100ms | Build-time only |

---

## 5. Story Breakdown

### Story 2.1: Hero Count Display

**As a** visitor,
**I want** to see the total number of AI obituaries prominently displayed,
**So that** I immediately understand the scale of documented skepticism.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.1.1 | Count displays prominently on homepage | Large number visible in hero section |
| AC-2.1.2 | Count uses Geist Mono font | Font family is monospace (Geist Mono) |
| AC-2.1.3 | Count is 4rem (64px) on desktop | Computed font-size is 64px at >= 1024px viewport |
| AC-2.1.4 | Count scales down on mobile | Font-size reduces appropriately at < 768px |
| AC-2.1.5 | Count uses gold color | Text color is `#C9A962` (--accent-primary) |
| AC-2.1.6 | Pulsing glow animation present | Box-shadow pulses with 3s ease-in-out infinite |
| AC-2.1.7 | "obituaries" label displayed | Text "obituaries" appears below the number |
| AC-2.1.8 | Count fetched server-side | `getObituaryCount()` called in Server Component |
| AC-2.1.9 | Count formatted with locale | Number displays as "1,247" not "1247" |
| AC-2.1.10 | Reduced motion disables animation | `prefers-reduced-motion: reduce` stops pulsing |

#### Technical Approach

```tsx
// src/components/obituary/count-display.tsx
import { getObituaryCount } from '@/lib/sanity/queries'

export async function CountDisplay() {
  const count = await getObituaryCount()
  const formattedCount = new Intl.NumberFormat('en-US').format(count)

  return (
    <div className="text-center">
      <span
        className="font-mono text-4xl md:text-5xl lg:text-[4rem] text-[--accent-primary]
                   animate-pulse-glow motion-reduce:animate-none"
      >
        {formattedCount}
      </span>
      <p className="text-[--text-secondary] mt-2 text-lg">obituaries</p>
    </div>
  )
}
```

**CSS Animation (in globals.css):**
```css
@keyframes pulse-glow {
  0%, 100% {
    text-shadow: 0 0 10px rgba(201, 169, 98, 0.3);
  }
  50% {
    text-shadow: 0 0 20px rgba(201, 169, 98, 0.6),
                 0 0 30px rgba(201, 169, 98, 0.3);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 3s ease-in-out infinite;
}

@media (prefers-reduced-motion: reduce) {
  .animate-pulse-glow {
    animation: none;
  }
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/obituary/count-display.tsx` | Create | Hero count component |
| `src/app/globals.css` | Modify | Add pulse-glow animation keyframes |
| `src/app/page.tsx` | Modify | Add CountDisplay to homepage |
| `src/lib/sanity/queries.ts` | Modify | Add `getObituaryCount()` if not already present |

#### Dependencies on Other Stories

- Depends on: Story 1.3 (Sanity integration)
- Depends on: Story 1.4 (Layout shell for homepage structure)

---

### Story 2.2: Obituary List Display

**As a** visitor,
**I want** to see a list of all obituaries with key information,
**So that** I can browse and find interesting claims.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.2.1 | Obituaries display as cards | Card components render for each obituary |
| AC-2.2.2 | Cards show claim text | Claim text visible (truncated to ~150 chars) |
| AC-2.2.3 | Cards show source name | Source attribution visible |
| AC-2.2.4 | Cards show formatted date | Date displays as "Mar 14, 2023" |
| AC-2.2.5 | Cards show category indicator | Colored dot matching category color visible |
| AC-2.2.6 | Cards use Deep Archive styling | Background `#18181F`, border-radius 12px, border `#2A2A35` |
| AC-2.2.7 | Cards have hover effect | translateY -2px and shadow on hover |
| AC-2.2.8 | Cards sorted by date | Newest obituaries appear first |
| AC-2.2.9 | Claim text uses Instrument Serif | Quote text renders in serif font, italic |
| AC-2.2.10 | Clicking card navigates to detail page | Click navigates to `/obituary/[slug]` |
| AC-2.2.11 | Cards are keyboard accessible | Tab focuses card, Enter/Space activates |

**Category Display Note:** Stories 2.1-2.8 display category indicators (colored dots and badges) for informational purposes only. Interactive category filtering (click to filter by category) is deferred to Epic 4. In Epic 2, categories are read-only visual elements.

#### Technical Approach

```tsx
// src/components/obituary/obituary-card.tsx
import Link from 'next/link'
import { format } from 'date-fns'
import { cn } from '@/lib/utils/cn'
import type { Obituary, Category } from '@/types/obituary'

const CATEGORY_COLORS: Record<Category, string> = {
  capability: 'bg-[--category-capability]',
  market: 'bg-[--category-market]',
  agi: 'bg-[--category-agi]',
  dismissive: 'bg-[--category-dismissive]',
}

interface ObituaryCardProps {
  obituary: Obituary
}

export function ObituaryCard({ obituary }: ObituaryCardProps) {
  const truncatedClaim = obituary.claim.length > 150
    ? obituary.claim.slice(0, 150) + '...'
    : obituary.claim

  return (
    <Link
      href={`/obituary/${obituary.slug}`}
      className={cn(
        'block p-6 rounded-xl',
        'bg-[--bg-card] border border-[--border]',
        'hover:-translate-y-0.5 hover:shadow-lg',
        'transition-all duration-200',
        'focus-visible:outline-none focus-visible:ring-2',
        'focus-visible:ring-[--accent-primary] focus-visible:ring-offset-2',
        'focus-visible:ring-offset-[--bg-primary]'
      )}
    >
      <div className="flex items-center gap-2 mb-3">
        <span className={cn(
          'w-2 h-2 rounded-full',
          CATEGORY_COLORS[obituary.categories[0]]
        )} />
        <span className="text-sm text-[--text-muted]">
          {format(new Date(obituary.date), 'MMM d, yyyy')}
        </span>
      </div>
      <p className="font-serif italic text-[--text-primary] mb-3 leading-relaxed">
        "{truncatedClaim}"
      </p>
      <p className="text-sm text-[--text-secondary]">
        {obituary.source}
      </p>
    </Link>
  )
}
```

```tsx
// src/components/obituary/obituary-list.tsx
import { getObituaries } from '@/lib/sanity/queries'
import { ObituaryCard } from './obituary-card'

export async function ObituaryList() {
  const obituaries = await getObituaries()

  if (obituaries.length === 0) {
    return (
      <div className="text-center py-12 text-[--text-muted]">
        No obituaries yet. Check back soon.
      </div>
    )
  }

  return (
    <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {obituaries.map((obituary) => (
        <ObituaryCard key={obituary._id} obituary={obituary} />
      ))}
    </div>
  )
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/obituary/obituary-card.tsx` | Create | Individual card component |
| `src/components/obituary/obituary-list.tsx` | Create | Grid container for cards |
| `src/app/page.tsx` | Modify | Add ObituaryList below CountDisplay |
| `src/lib/constants/categories.ts` | Create | Category color constants (if not already) |

#### Dependencies on Other Stories

- Depends on: Story 2.1 (homepage structure with CountDisplay)
- Depends on: Story 1.3 (Sanity queries)

---

### Story 2.3: Individual Obituary Pages

**As a** visitor,
**I want** each obituary to have its own dedicated page,
**So that** I can view full details and share specific obituaries.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.3.1 | Page exists at `/obituary/[slug]` | URL pattern works for valid slugs |
| AC-2.3.2 | Full claim text displayed | No truncation, large serif font |
| AC-2.3.3 | Source name with external link | Link to original article opens in new tab |
| AC-2.3.4 | Full date displayed | Format: "March 14, 2023" |
| AC-2.3.5 | Category tags as badges | Colored badges for each category |
| AC-2.3.6 | Back link to homepage | Link to navigate back |
| AC-2.3.7 | Claim displayed as hero quote | Centered, prominent styling |
| AC-2.3.8 | External link has security attrs | `rel="noopener noreferrer"` present |
| AC-2.3.9 | 404 for invalid slugs | Non-existent slug shows not-found page |
| AC-2.3.10 | Pages statically generated | `generateStaticParams` returns all slugs |

#### Technical Approach

```tsx
// src/app/obituary/[slug]/page.tsx
import { notFound } from 'next/navigation'
import { getObituaryBySlug, getAllObituarySlugs } from '@/lib/sanity/queries'
import { ObituaryDetail } from '@/components/obituary/obituary-detail'
import { ObituaryContext } from '@/components/obituary/obituary-context'
import { JsonLd } from '@/components/seo/json-ld'
import { generateObituaryMetadata } from '@/lib/utils/seo'

interface PageProps {
  params: Promise<{ slug: string }>
}

export async function generateStaticParams() {
  const slugs = await getAllObituarySlugs()
  return slugs.map((slug) => ({ slug }))
}

export async function generateMetadata({ params }: PageProps) {
  const { slug } = await params
  const obituary = await getObituaryBySlug(slug)
  if (!obituary) return {}
  return generateObituaryMetadata(obituary)
}

export default async function ObituaryPage({ params }: PageProps) {
  const { slug } = await params
  const obituary = await getObituaryBySlug(slug)

  if (!obituary) {
    notFound()
  }

  return (
    <>
      <JsonLd obituary={obituary} />
      <main className="max-w-3xl mx-auto px-4 py-12">
        <ObituaryDetail obituary={obituary} />
        <ObituaryContext context={obituary.context} />
      </main>
    </>
  )
}
```

```tsx
// src/components/obituary/obituary-detail.tsx
import Link from 'next/link'
import { format } from 'date-fns'
import { ExternalLink, ArrowLeft } from 'lucide-react'
import { CopyButton } from '@/components/ui/copy-button'
import type { Obituary, Category } from '@/types/obituary'

const CATEGORY_LABELS: Record<Category, string> = {
  capability: 'Capability Doubt',
  market: 'Market/Bubble',
  agi: 'AGI Skepticism',
  dismissive: 'Dismissive Framing',
}

const CATEGORY_COLORS: Record<Category, string> = {
  capability: 'bg-[--category-capability]/20 text-[--category-capability]',
  market: 'bg-[--category-market]/20 text-[--category-market]',
  agi: 'bg-[--category-agi]/20 text-[--category-agi]',
  dismissive: 'bg-[--category-dismissive]/20 text-[--category-dismissive]',
}

interface ObituaryDetailProps {
  obituary: Obituary
}

export function ObituaryDetail({ obituary }: ObituaryDetailProps) {
  return (
    <article>
      <Link
        href="/"
        className="inline-flex items-center gap-2 text-[--text-secondary]
                   hover:text-[--text-primary] mb-8 transition-colors"
      >
        <ArrowLeft className="w-4 h-4" />
        Back to all obituaries
      </Link>

      <blockquote className="font-serif text-2xl md:text-3xl lg:text-4xl
                             text-[--text-primary] italic text-center
                             leading-relaxed mb-8">
        "{obituary.claim}"
      </blockquote>

      <div className="flex flex-col items-center gap-4 mb-8">
        <p className="text-[--text-secondary]">
          <a
            href={obituary.sourceUrl}
            target="_blank"
            rel="noopener noreferrer"
            className="inline-flex items-center gap-1 hover:text-[--accent-primary]
                       transition-colors underline underline-offset-4"
          >
            {obituary.source}
            <ExternalLink className="w-4 h-4" />
          </a>
        </p>
        <time
          dateTime={obituary.date}
          className="text-[--text-muted]"
        >
          {format(new Date(obituary.date), 'MMMM d, yyyy')}
        </time>
      </div>

      <div className="flex flex-wrap justify-center gap-2 mb-8">
        {obituary.categories.map((category) => (
          <span
            key={category}
            className={`px-3 py-1 rounded-full text-sm font-medium ${CATEGORY_COLORS[category]}`}
          >
            {CATEGORY_LABELS[category]}
          </span>
        ))}
      </div>

      <div className="flex justify-center">
        <CopyButton />
      </div>
    </article>
  )
}
```

```tsx
// src/app/obituary/[slug]/not-found.tsx
import Link from 'next/link'

export default function NotFound() {
  return (
    <div className="min-h-[60vh] flex flex-col items-center justify-center text-center px-4">
      <h1 className="text-4xl font-serif text-[--text-primary] mb-4">
        Obituary Not Found
      </h1>
      <p className="text-[--text-secondary] mb-8">
        This obituary doesn't exist or may have been removed.
      </p>
      <Link
        href="/"
        className="px-6 py-3 bg-[--accent-primary] text-[--bg-primary]
                   rounded-lg font-medium hover:opacity-90 transition-opacity"
      >
        Return to Homepage
      </Link>
    </div>
  )
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/app/obituary/[slug]/page.tsx` | Create | Dynamic route page |
| `src/app/obituary/[slug]/not-found.tsx` | Create | 404 page for invalid slugs |
| `src/components/obituary/obituary-detail.tsx` | Create | Full detail view component |
| `src/lib/sanity/queries.ts` | Modify | Add `getAllObituarySlugs()` |

#### Dependencies on Other Stories

- Depends on: Story 1.3 (Sanity queries)
- Depends on: Story 1.4 (Layout for page structure)

---

### Story 2.4: Contextual Snapshot Display

**As a** visitor,
**I want** to see what AI could do when each claim was made,
**So that** I can judge the prediction against reality at the time.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.4.1 | Context section displays on detail page | "Context at Time" section visible |
| AC-2.4.2 | Stock prices display if available | NVDA/MSFT/GOOG prices formatted as currency |
| AC-2.4.3 | AI model info displays if available | "Latest model: GPT-4" style display |
| AC-2.4.4 | Benchmark displays if available | Benchmark name and score shown |
| AC-2.4.5 | Milestone displays if available | Milestone description shown |
| AC-2.4.6 | Additional note displays if available | Note text in muted styling |
| AC-2.4.7 | Graceful partial data handling | Only available fields shown |
| AC-2.4.8 | Graceful empty data handling | "Context data unavailable" shown if empty |
| AC-2.4.9 | Currency formatting correct | Prices show as "$145.23" |
| AC-2.4.10 | Section styled consistently | Uses Deep Archive card styling |

#### Technical Approach

```tsx
// src/components/obituary/obituary-context.tsx
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'
import type { ContextMetadata } from '@/types/obituary'

interface ObituaryContextProps {
  context: ContextMetadata
}

function formatCurrency(value: number): string {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
  }).format(value)
}

export function ObituaryContext({ context }: ObituaryContextProps) {
  const hasAnyData =
    context.nvdaPrice !== undefined ||
    context.msftPrice !== undefined ||
    context.googPrice !== undefined ||
    context.benchmarkName !== undefined ||
    context.currentModel !== undefined ||
    context.milestone !== undefined ||
    context.note !== undefined

  if (!hasAnyData) {
    return (
      <section className="mt-12 pt-8 border-t border-[--border]">
        <h2 className="text-lg font-semibold text-[--text-primary] mb-4">
          Context at Time
        </h2>
        <p className="text-[--text-muted]">Context data unavailable</p>
      </section>
    )
  }

  return (
    <section className="mt-12 pt-8 border-t border-[--border]">
      <h2 className="text-lg font-semibold text-[--text-primary] mb-4">
        Context at Time
      </h2>

      <div className="grid gap-4 md:grid-cols-2">
        {/* Stock Prices */}
        {(context.nvdaPrice || context.msftPrice || context.googPrice) && (
          <Card className="bg-[--bg-card] border-[--border]">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-[--text-secondary]">
                Stock Prices
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-1">
              {context.nvdaPrice !== undefined && (
                <p className="text-[--text-primary]">
                  NVDA: {formatCurrency(context.nvdaPrice)}
                </p>
              )}
              {context.msftPrice !== undefined && (
                <p className="text-[--text-primary]">
                  MSFT: {formatCurrency(context.msftPrice)}
                </p>
              )}
              {context.googPrice !== undefined && (
                <p className="text-[--text-primary]">
                  GOOG: {formatCurrency(context.googPrice)}
                </p>
              )}
            </CardContent>
          </Card>
        )}

        {/* AI Model */}
        {context.currentModel && (
          <Card className="bg-[--bg-card] border-[--border]">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-[--text-secondary]">
                Latest AI Model
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-[--text-primary]">{context.currentModel}</p>
            </CardContent>
          </Card>
        )}

        {/* Benchmark */}
        {context.benchmarkName && (
          <Card className="bg-[--bg-card] border-[--border]">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-[--text-secondary]">
                Benchmark
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-[--text-primary]">
                {context.benchmarkName}
                {context.benchmarkScore !== undefined && (
                  <span className="ml-2 text-[--accent-primary] font-mono">
                    {context.benchmarkScore}%
                  </span>
                )}
              </p>
            </CardContent>
          </Card>
        )}

        {/* Milestone */}
        {context.milestone && (
          <Card className="bg-[--bg-card] border-[--border]">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-[--text-secondary]">
                AI Milestone
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-[--text-primary]">{context.milestone}</p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Additional Note */}
      {context.note && (
        <p className="mt-4 text-sm text-[--text-muted] italic">
          {context.note}
        </p>
      )}
    </section>
  )
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/obituary/obituary-context.tsx` | Create | Context metadata display |
| `src/components/ui/card.tsx` | Add | shadcn Card component (if not present) |

#### Dependencies on Other Stories

- Depends on: Story 2.3 (individual obituary pages)

---

### Story 2.5: SEO Meta Tags

**As a** content sharer,
**I want** obituary pages to have rich meta tags,
**So that** shared links look good on social media and search.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.5.1 | Title tag present | Format: "[Claim preview...] - AI Obituaries" |
| AC-2.5.2 | Title max 60 chars | Truncated with ellipsis if needed |
| AC-2.5.3 | Meta description present | Max 155 chars with claim and source |
| AC-2.5.4 | og:title present | Same as title |
| AC-2.5.5 | og:description present | Same as meta description |
| AC-2.5.6 | og:type is "article" | `<meta property="og:type" content="article">` |
| AC-2.5.7 | og:url is canonical | Full URL to obituary page |
| AC-2.5.8 | og:image present | Default OG image path |
| AC-2.5.9 | og:site_name present | "AI Obituaries" |
| AC-2.5.10 | twitter:card present | "summary_large_image" |
| AC-2.5.11 | twitter:title present | Same as title |
| AC-2.5.12 | twitter:description present | Same as description |
| AC-2.5.13 | Homepage has custom meta | Title and description for homepage |

#### Technical Approach

```tsx
// src/lib/utils/seo.ts
import type { Metadata } from 'next'
import type { Obituary } from '@/types/obituary'

const SITE_NAME = 'AI Obituaries'
const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || 'https://aiobituaries.com'

function truncate(str: string, maxLength: number): string {
  if (str.length <= maxLength) return str
  return str.slice(0, maxLength - 3) + '...'
}

export function generateObituaryMetadata(obituary: Obituary): Metadata {
  const title = truncate(`${obituary.claim} - ${SITE_NAME}`, 60)
  const description = truncate(
    `${obituary.source} claimed "${obituary.claim}" on ${obituary.date}. See the full context.`,
    155
  )
  const url = `${BASE_URL}/obituary/${obituary.slug}`

  return {
    title,
    description,
    openGraph: {
      title,
      description,
      type: 'article',
      url,
      siteName: SITE_NAME,
      images: [
        {
          url: `${BASE_URL}/og/default.png`,
          width: 1200,
          height: 630,
          alt: title,
        },
      ],
    },
    twitter: {
      card: 'summary_large_image',
      title,
      description,
      images: [`${BASE_URL}/og/default.png`],
    },
    alternates: {
      canonical: url,
    },
  }
}

export const homepageMetadata: Metadata = {
  title: 'AI Obituaries - Documenting AI Skepticism',
  description: 'A data-driven archive of every time critics declared AI dead, overhyped, or a bubble. Documented predictions with full context.',
  openGraph: {
    title: 'AI Obituaries - Documenting AI Skepticism',
    description: 'A data-driven archive of every time critics declared AI dead, overhyped, or a bubble.',
    type: 'website',
    url: BASE_URL,
    siteName: SITE_NAME,
    images: [
      {
        url: `${BASE_URL}/og/default.png`,
        width: 1200,
        height: 630,
        alt: 'AI Obituaries',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'AI Obituaries - Documenting AI Skepticism',
    description: 'A data-driven archive of every time critics declared AI dead, overhyped, or a bubble.',
    images: [`${BASE_URL}/og/default.png`],
  },
}
```

```tsx
// src/app/page.tsx - add metadata export
import { homepageMetadata } from '@/lib/utils/seo'

export const metadata = homepageMetadata

// ... rest of page
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/lib/utils/seo.ts` | Create | SEO helper functions |
| `src/app/page.tsx` | Modify | Add metadata export |
| `src/app/obituary/[slug]/page.tsx` | Modify | Add generateMetadata |
| `src/app/layout.tsx` | Modify | Add base metadata if needed |
| `public/og/default.png` | Create | Default OG image (1200x630) |

#### Dependencies on Other Stories

- Depends on: Story 2.3 (individual obituary pages)

---

### Story 2.6: JSON-LD Structured Data

**As a** search engine,
**I want** structured data on obituary pages,
**So that** I can display rich snippets in search results.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.6.1 | JSON-LD script present | `<script type="application/ld+json">` in page |
| AC-2.6.2 | @context is schema.org | `"@context": "https://schema.org"` |
| AC-2.6.3 | @type is Article | `"@type": "Article"` |
| AC-2.6.4 | headline present | Contains claim preview |
| AC-2.6.5 | datePublished present | ISO 8601 date format |
| AC-2.6.6 | author present | Source as Person type |
| AC-2.6.7 | publisher present | AI Obituaries as Organization |
| AC-2.6.8 | description present | Meta description |
| AC-2.6.9 | url present | Canonical URL |
| AC-2.6.10 | Homepage has WebSite schema | Organization structured data on homepage |
| AC-2.6.11 | Validates with Google tool | Passes Rich Results Test |

#### Technical Approach

```tsx
// src/components/seo/json-ld.tsx
import type { Obituary } from '@/types/obituary'

const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || 'https://aiobituaries.com'

function truncate(str: string, maxLength: number): string {
  if (str.length <= maxLength) return str
  return str.slice(0, maxLength - 3) + '...'
}

interface JsonLdProps {
  obituary?: Obituary
  type?: 'article' | 'website'
}

export function JsonLd({ obituary, type = 'article' }: JsonLdProps) {
  if (type === 'website' || !obituary) {
    const websiteSchema = {
      '@context': 'https://schema.org',
      '@type': 'WebSite',
      name: 'AI Obituaries',
      description: 'A data-driven archive documenting AI skepticism',
      url: BASE_URL,
    }

    return (
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(websiteSchema) }}
      />
    )
  }

  const articleSchema = {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: truncate(obituary.claim, 110),
    datePublished: obituary.date,
    author: {
      '@type': 'Person',
      name: obituary.source,
    },
    publisher: {
      '@type': 'Organization',
      name: 'AI Obituaries',
      url: BASE_URL,
    },
    description: truncate(
      `${obituary.source} claimed "${obituary.claim}" on ${obituary.date}. See the full context.`,
      155
    ),
    url: `${BASE_URL}/obituary/${obituary.slug}`,
  }

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(articleSchema) }}
    />
  )
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/seo/json-ld.tsx` | Create | Structured data component |
| `src/app/obituary/[slug]/page.tsx` | Modify | Add JsonLd component |
| `src/app/page.tsx` | Modify | Add JsonLd type="website" |

#### Dependencies on Other Stories

- Depends on: Story 2.5 (SEO meta tags setup)

---

### Story 2.7: Sitemap Generation

**As a** search engine crawler,
**I want** a sitemap listing all obituary pages,
**So that** I can discover and index all content.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.7.1 | Sitemap at /sitemap.xml | URL returns valid XML |
| AC-2.7.2 | Homepage URL included | `<url>` entry for `/` |
| AC-2.7.3 | About page URL included | `<url>` entry for `/about` |
| AC-2.7.4 | All obituary URLs included | Each obituary has `<url>` entry |
| AC-2.7.5 | lastmod dates present | Each URL has `<lastmod>` element |
| AC-2.7.6 | Valid XML sitemap format | Follows sitemap protocol |
| AC-2.7.7 | robots.txt exists | `/robots.txt` returns content |
| AC-2.7.8 | robots.txt allows all | `User-agent: * Allow: /` |
| AC-2.7.9 | robots.txt references sitemap | `Sitemap:` directive present |
| AC-2.7.10 | Sitemap updates with ISR | New obituaries appear after revalidation |

**ISR Integration Note:** The `sitemap.ts` file automatically fetches fresh data on each request (no static generation). When the ISR revalidation webhook (Story 1.5) triggers, it invalidates the `obituaries` cache tag, causing `getObituaries()` to return updated data. This means newly published obituaries appear in the sitemap without requiring a full rebuild.

#### Technical Approach

```tsx
// src/app/sitemap.ts
import type { MetadataRoute } from 'next'
import { getObituaries } from '@/lib/sanity/queries'

const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || 'https://aiobituaries.com'

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const obituaries = await getObituaries()

  const obituaryUrls = obituaries.map((obituary) => ({
    url: `${BASE_URL}/obituary/${obituary.slug}`,
    lastModified: new Date(obituary.date),
    changeFrequency: 'monthly' as const,
    priority: 0.8,
  }))

  return [
    {
      url: BASE_URL,
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    {
      url: `${BASE_URL}/about`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.5,
    },
    ...obituaryUrls,
  ]
}
```

```tsx
// src/app/robots.ts
import type { MetadataRoute } from 'next'

const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || 'https://aiobituaries.com'

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
    },
    sitemap: `${BASE_URL}/sitemap.xml`,
  }
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/app/sitemap.ts` | Create | Dynamic sitemap generation |
| `src/app/robots.ts` | Create | Robots.txt generation |

#### Dependencies on Other Stories

- Depends on: Story 2.3 (obituary pages exist)
- Depends on: Story 1.5 (ISR for sitemap updates)

---

### Story 2.8: Share/Copy Link

**As a** visitor,
**I want** to easily copy a link to share an obituary,
**So that** I can use it in debates and discussions.

#### Acceptance Criteria

| AC ID | Criterion | Testable Condition |
|-------|-----------|-------------------|
| AC-2.8.1 | Copy button visible on detail page | Button labeled "Copy link" present |
| AC-2.8.2 | Click copies URL to clipboard | `navigator.clipboard.writeText()` called with URL |
| AC-2.8.3 | Success toast appears | Toast shows "Link copied to clipboard" |
| AC-2.8.4 | Toast positioned bottom-right | Toast appears in bottom-right corner |
| AC-2.8.5 | Toast has checkmark icon | Success icon visible |
| AC-2.8.6 | Toast uses success color | Green (#7B9E89) styling |
| AC-2.8.7 | Toast auto-dismisses | Disappears after 3 seconds |
| AC-2.8.8 | Error handling for clipboard failure | Fallback message shown |
| AC-2.8.9 | Button has link/copy icon | Icon visible on button |
| AC-2.8.10 | Button uses outline variant | `variant="outline"` with gold hover state |

**Button Style Note:** The copy button uses the "outline" variant (not "secondary") with a gold hover effect. On hover, the border transitions to `--accent-primary` (#C9A962) to match the Deep Archive theme.

#### Technical Approach

```tsx
// src/components/ui/copy-button.tsx
'use client'

import { useState } from 'react'
import { Link2, Check } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { useToast } from '@/components/ui/use-toast'

export function CopyButton() {
  const [copied, setCopied] = useState(false)
  const { toast } = useToast()

  const handleCopy = async () => {
    const url = window.location.href

    try {
      await navigator.clipboard.writeText(url)
      setCopied(true)
      toast({
        title: 'Link copied to clipboard',
        description: 'Share this obituary with others.',
        duration: 3000,
      })
      setTimeout(() => setCopied(false), 2000)
    } catch {
      toast({
        title: 'Couldn\'t copy link',
        description: 'Try selecting the URL manually from the address bar.',
        variant: 'destructive',
        duration: 5000,
      })
    }
  }

  return (
    <Button
      variant="outline"
      onClick={handleCopy}
      className="gap-2 hover:border-[--accent-primary] hover:text-[--accent-primary]"
    >
      {copied ? (
        <Check className="w-4 h-4" />
      ) : (
        <Link2 className="w-4 h-4" />
      )}
      {copied ? 'Copied!' : 'Copy link'}
    </Button>
  )
}
```

**Add shadcn Toast components:**
```bash
npx shadcn@latest add toast
```

**Update layout to include Toaster:**
```tsx
// src/app/layout.tsx
import { Toaster } from '@/components/ui/toaster'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Toaster />
      </body>
    </html>
  )
}
```

#### Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/components/ui/copy-button.tsx` | Create | Copy link button component |
| `src/components/ui/toast.tsx` | Add | shadcn toast (via CLI) |
| `src/components/ui/toaster.tsx` | Add | shadcn toaster (via CLI) |
| `src/components/ui/use-toast.ts` | Add | shadcn toast hook (via CLI) |
| `src/app/layout.tsx` | Modify | Add Toaster component |

#### Dependencies on Other Stories

- Depends on: Story 2.3 (detail pages where button appears)

---

## 6. Implementation Guidelines

### 6.1 Coding Standards

| Standard | Requirement |
|----------|-------------|
| **Server vs Client** | Default to Server Components; only use `'use client'` for interactivity (CopyButton, Toast) |
| **Data Fetching** | Always fetch in Server Components, pass data as props to Client Components |
| **Async Components** | Use `async` Server Components for data fetching |
| **Type Safety** | All props must be typed with TypeScript interfaces |
| **Error Handling** | Use `notFound()` for missing data, graceful fallbacks for partial data |

### 6.2 Component Architecture Patterns

```
Server Component (page.tsx)
    │
    ├── Fetch data from Sanity
    ├── Generate metadata
    │
    └── Render
         ├── JsonLd (Server - static output)
         ├── ObituaryDetail (Server - no interactivity)
         │     └── CopyButton (Client - clipboard API)
         └── ObituaryContext (Server - display only)
```

### 6.3 Testing Requirements

| Test Type | Scope for Epic 2 | Tool |
|-----------|------------------|------|
| Unit Tests | SEO utils, formatting functions | Vitest |
| Component Tests | CountDisplay, ObituaryCard, CopyButton | Vitest + Testing Library |
| Integration | Page renders with mock data | Vitest + Testing Library |
| E2E Tests | Navigation, copy button, 404 page | Playwright |

**Story-Level Test Scenarios:**

| Story | Test Type | Specific Scenarios |
|-------|-----------|-------------------|
| 2.1 | Component | Count renders with formatted number; animation class present; reduced motion disabled |
| 2.2 | Component | Cards render all fields; hover state applies; click navigates to slug |
| 2.3 | Integration | Page renders with valid slug; 404 for invalid slug; generateStaticParams returns all slugs |
| 2.4 | Component | All context fields display when present; empty state shows message; partial data handles gracefully |
| 2.5 | Unit | Metadata generated with correct format; truncation works at boundaries |
| 2.6 | Unit | JSON-LD schema validates; all required fields present |
| 2.7 | E2E | /sitemap.xml returns valid XML; /robots.txt has sitemap reference |
| 2.8 | Component | Click triggers clipboard API; toast appears; error state handles gracefully |

### 6.4 Performance Considerations

| Consideration | Implementation |
|---------------|----------------|
| **Static Generation** | All obituary pages statically generated via `generateStaticParams` |
| **ISR Integration** | Pages revalidate when webhook triggers |
| **Image Optimization** | OG images served from static `/public/og/` |
| **Font Loading** | Fonts already configured in Epic 1 |
| **Bundle Size** | Client components minimal (CopyButton only) |

---

## 7. Traceability Matrix

### 7.1 FR to Story Mapping

| FR ID | Requirement Description | Story ID | Acceptance Criteria |
|-------|-------------------------|----------|---------------------|
| FR1 | Display total obituary count prominently | 2.1 | AC-2.1.1 through AC-2.1.10 |
| FR2 | Display list of all obituaries | 2.2 | AC-2.2.1 through AC-2.2.11 |
| FR3 | View individual obituary details | 2.3 | AC-2.3.1 through AC-2.3.10 |
| FR4 | Display contextual data | 2.4 | AC-2.4.1 through AC-2.4.10 |
| FR19 | Dedicated page with semantic URL | 2.3 | AC-2.3.1 |
| FR23 | Contextual snapshot display | 2.4 | AC-2.4.1 through AC-2.4.10 |
| FR27 | Unique meta title and description | 2.5 | AC-2.5.1 through AC-2.5.3 |
| FR28 | Open Graph and Twitter Card tags | 2.5 | AC-2.5.4 through AC-2.5.12 |
| FR29 | JSON-LD structured data | 2.6 | AC-2.6.1 through AC-2.6.11 |
| FR30 | Auto-generate sitemap | 2.7 | AC-2.7.1 through AC-2.7.10 |
| FR32 | Copy shareable link | 2.8 | AC-2.8.1 through AC-2.8.10 |
| FR33 | Display well when shared | 2.5, 2.8 | AC-2.5.4 through AC-2.5.12 |

### 7.2 Story to Component Mapping

| Story | Components Created | Location |
|-------|-------------------|----------|
| 2.1 | CountDisplay | `src/components/obituary/count-display.tsx` |
| 2.2 | ObituaryCard, ObituaryList | `src/components/obituary/` |
| 2.3 | ObituaryDetail, not-found page | `src/components/obituary/`, `src/app/obituary/[slug]/` |
| 2.4 | ObituaryContext | `src/components/obituary/obituary-context.tsx` |
| 2.5 | SEO utilities | `src/lib/utils/seo.ts` |
| 2.6 | JsonLd | `src/components/seo/json-ld.tsx` |
| 2.7 | sitemap, robots | `src/app/sitemap.ts`, `src/app/robots.ts` |
| 2.8 | CopyButton, Toast (shadcn) | `src/components/ui/copy-button.tsx` |

### 7.3 Test Coverage Mapping

| Component/Module | Test File | Coverage Target |
|------------------|-----------|-----------------|
| `src/lib/utils/seo.ts` | `tests/unit/lib/utils/seo.test.ts` | 100% |
| `src/components/obituary/count-display.tsx` | `tests/components/obituary/count-display.test.tsx` | Render, formatting |
| `src/components/obituary/obituary-card.tsx` | `tests/components/obituary/obituary-card.test.tsx` | Render, truncation |
| `src/components/obituary/obituary-context.tsx` | `tests/components/obituary/obituary-context.test.tsx` | All states |
| `src/components/ui/copy-button.tsx` | `tests/components/ui/copy-button.test.tsx` | Click, toast |
| `src/components/seo/json-ld.tsx` | `tests/components/seo/json-ld.test.tsx` | Schema validation |

---

## 8. Non-Functional Requirements

### 8.1 Performance Targets for Epic 2

| Metric | Target | Rationale |
|--------|--------|-----------|
| Homepage LCP | < 2.5s | Count and first cards visible quickly |
| Obituary page LCP | < 2.0s | Simpler page, faster render |
| CLS | < 0.1 | No layout shifts from cards or count |
| Bundle increase | < 20KB | Minimal client-side code |

### 8.2 SEO Requirements

| Requirement | Implementation |
|-------------|----------------|
| **Crawlability** | All pages static, sitemap auto-generated |
| **Meta Tags** | Unique title/description per page |
| **Structured Data** | Article schema for obituaries |
| **Social Sharing** | OG and Twitter cards for all pages |

### 8.3 Accessibility Requirements

| Requirement | Implementation |
|-------------|----------------|
| **Keyboard Navigation** | Cards focusable and activatable |
| **Screen Reader** | Semantic HTML, aria-labels where needed |
| **Color Contrast** | All text meets WCAG AA (verified in Epic 1) |
| **Focus Indicators** | Visible focus rings on cards and buttons |

---

## 9. Risks, Assumptions, and Questions

### 9.1 Risks

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Sanity has no test data | Medium | High | Create mock obituary data for development |
| OG image not designed | Low | Low | Use placeholder, design can come later |
| Clipboard API not supported | Low | Low | Fallback message implemented |
| Large number of obituaries | Low | Medium | Pagination can be added in Epic 5/6 |

### 9.2 Assumptions

| Assumption | Impact if Invalid |
|------------|-------------------|
| Sanity schema already deployed | Cannot test with real data |
| At least a few test obituaries exist | Empty states tested but real content preferred |
| BASE_URL env var configured | OG images will have wrong URLs |
| shadcn Card component exists | May need to add via CLI |

### 9.3 Open Questions

| Question | Status | Owner |
|----------|--------|-------|
| Should count include subtitle like "and counting"? | Open | Design |
| Should cards show multiple category dots or just first? | Assumed: First only | Design |
| Should 404 page have suggested obituaries? | Assumed: No (MVP) | PM |

---

## 10. Epic Completion Criteria

- [ ] Count displays prominently with gold styling and pulsing glow
- [ ] Obituary cards show claim, source, date, category indicator
- [ ] Cards have hover effect and navigate to detail pages
- [ ] Individual pages load with full content and semantic URLs
- [ ] Contextual data displays when available
- [ ] Empty context shows "unavailable" message
- [ ] Meta tags render correctly (test with Facebook/Twitter debuggers)
- [ ] JSON-LD validates with Google Rich Results Test
- [ ] Sitemap accessible at /sitemap.xml with all obituary URLs
- [ ] Robots.txt accessible at /robots.txt with sitemap reference
- [ ] Copy link button works with toast feedback
- [ ] 404 page displays for invalid slugs
- [ ] All pages statically generated (verify in build output)
- [ ] Reduced motion disables count animation

---

## Summary Statistics

| Metric | Count |
|--------|-------|
| Stories in Epic | 8 |
| Total Acceptance Criteria | 95 |
| Functional Requirements Covered | 12 |
| Components to Create | 9 |
| Pages to Create | 3 (obituary detail, sitemap, robots) |
| shadcn Components to Add | 3 (Card, Toast, Toaster) |

---

_Generated by Epic Tech Context Specialist_
_Date: 2025-11-29_
_For: AI Obituaries Project_
